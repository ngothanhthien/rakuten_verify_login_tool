# Rakuten Project

## Development Workflow

This project uses TypeScript and runs directly via `tsx` (no compilation needed for development).

### Scripts

- `npm start` - Run the application (uses tsx to run TypeScript directly)
- `npm run dev` - Same as start (for development)
- `npm run build` - Compile TypeScript to JavaScript (outputs to `dist/` - optional)

### Project Structure

```
rakuten/
├── application/       # Application layer (use cases, services)
├── core/             # Domain layer (entities, value objects)
├── infrastructure/   # Infrastructure layer (DB, HTTP, external services)
├── frontend/         # Frontend Vue application
├── dist/             # Compiled JavaScript (optional, generated by build)
└── node_modules/     # Dependencies
```

### Development

1. Make changes to `.ts` files
2. Run `npm start` to run the application
3. The application will run TypeScript directly using `tsx`

## Proxy Requirements

The application uses a worker-based proxy injection model for credential verification. Each worker requires dedicated proxies to operate efficiently.

### Proxy Quantity

- **Minimum**: `CONCURRENCY` proxies (e.g., 40 proxies for default concurrency of 40)
- **Recommended**: `CONCURRENCY * 2` proxies for full round-robin coverage
- Each worker is assigned exactly 2 proxies at startup

### Worker Behavior

- Workers round-robin between their 2 assigned proxies
- Workers terminate automatically when both assigned proxies die
- Proxy health is monitored continuously
- Failed proxies are automatically replaced from the available pool

### Configuration

Proxy requirements are controlled by:
- `CREDENTIAL_CHECK_CONCURRENCY` environment variable (default: 40)
- Proxy pool size in the database (`proxies` table)
- Worker lifecycle management ensures optimal resource utilization

### Notes

- **No compilation needed**: `tsx` runs TypeScript files directly
- All `.js` files in source directories are ignored by git (they shouldn't exist)
- The `dist/` folder is only used if you manually run `npm run build`
- Never manually create `.js` files in source directories

## Package for Windows (single folder)

1. Install deps and generate Prisma client (fetches Windows query engine): `npm install && npm run prisma:generate`.
2. Build the Vue frontend once: `npm run build:frontend` (copies output to `frontend-dist/`).
3. Package the backend + runtime files with tsup: `npm run package:windows`.
   - Output: `dist-windows/` plus `dist-windows.zip` (if `zip` CLI is available).
4. Ship `dist-windows.zip` to Windows, unzip, and double-click `start.bat` (requires Node.js and Chrome installed on the machine).

What gets included:
- Bundled backend (`main.cjs`) built with tsup for Node 18+
- Frontend assets (`frontend-dist/`)
- SQLite DB copy (`dev.db`) and `.env` pointing to it
- Prisma query engine binaries under `node_modules/.prisma/client`
